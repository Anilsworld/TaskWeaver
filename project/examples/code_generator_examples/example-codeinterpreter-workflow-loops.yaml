enabled: True
description: >-
  LOOP pattern for repetitive operations (90% token reduction).
  
  üîÅ USE LOOPS when user says "fetch from A, B, C" or "send to X, Y, Z"
  - Same operation repeated across multiple items
  - All items use THE SAME tool_id
  - Example: "Send notifications to Alice, Bob, Carol, David"
    ‚úÖ USE: loops (1500 tokens) vs ‚ùå 4 separate nodes (6000 tokens)
  
  ‚ö° LOOP BENEFITS:
  - 70-90% token reduction (scales infinitely)
  - No LLM token limits (loop definition is tiny)
  - Runtime expands to N parallel executions via LangGraph Send pattern
  
  üö® ONLY use loops when SAME tool_id for all items!
  - Different operations? Use parallel_groups instead
  
  üìù ALTERNATIVE SIMPLE EXAMPLES:
  1. "Get my last 3 Slack messages and reply to each" ‚Üí Loop over messages, reply to each
  2. "Fetch repository info from GitHub projects A, B, C and create report" ‚Üí Loop searches, aggregate results
  3. "Send invites to alice@email.com, bob@email.com, carol@email.com" ‚Üí Loop over emails, send invites

rounds:
  - user_query: Create a workflow to fetch repository information for multiple GitHub projects, then create a spreadsheet with all the results.
    state: finished
    post_list:
      - message: Fetch repository information for multiple GitHub projects, then create a spreadsheet with all the results.
        send_from: Planner
        send_to: CodeInterpreter
        attachment_list: []
      
      - message: I've created an optimized workflow using LOOP pattern to handle multiple repositories with minimal tokens.
        send_from: CodeInterpreter
        send_to: Planner
        attachment_list:
          - type: thought
            content: |-
              üîç COMPLEXITY ANALYSIS DETECTED:
              - Operation: "fetch repository info" (same action repeated)
              - Repositories: 3 projects (3 items)
              - Tool: GITHUB_GET_REPOSITORY (same tool_id for all repos)
              
              ‚úÖ DECISION: USE LOOP PATTERN
              - WITHOUT loop: 3 fetch nodes = 3 nodes √ó 800 tokens = 2400 tokens
              - WITH loop: 1 loop definition + 2 other nodes = 3 items √ó 400 tokens = 1200 tokens
              - SAVINGS: 1200 tokens (50% reduction!)
              
              üìã WORKFLOW STRUCTURE:
              1. collect_repositories: Form to get list of repository names from user
              2. fetch_repo_loop: Loop over repositories, fetch info for each
              3. create_spreadsheet: Create spreadsheet with results
              4. update_spreadsheet: Add all repository data to spreadsheet
              
              üîÅ LOOP SYNTAX:
              loops: [{
                "id": "loop_id",
                "loop_over": "${{from_step:step_id.field_name}}",
                "nodes": [{"id": "nested_node", "type": "agent_with_tools", ...}],
                "parallel": True,
                "max_iterations": 10
              }]
              
              üì¶ LOOP OUTPUT AGGREGATION:
              - Loop results are automatically collected in loop_aggregated_outputs
              - Reference aggregated results: ${{from_loop:loop_id.field_name}}
              - Example: ${{from_loop:fetch_repo_loop.results}} gets ALL results from loop
              - This is different from ${{from_step:...}} which references individual node outputs
              - Use loop aggregation to collect data from ALL iterations for downstream processing
          
          - type: reply_type
            content: python
          
          - type: reply_content
            content: |-
              WORKFLOW = {
                "nodes": [
                  {"id": "collect_repositories", "type": "form", "form_id": "repo_form", "title": "Select Repositories", "fields": [{"name": "repositories", "label": "Repository names to fetch", "type": "multiselect", "options": ["nodejs/node", "facebook/react", "microsoft/vscode"], "required": True}], "description": "Collect list of GitHub repositories"},
                  {"id": "fetch_repo_loop", "type": "loop", "loop_over": "${{from_step:collect_repositories.repositories}}", "nodes": [
                  {"id": "fetch_repository", "type": "agent_with_tools", "tool_id": "GITHUB_GET_REPOSITORY", "app_name": "github", "params": {"owner": "${{loop_item.split('/')[0]}}", "repo": "${{loop_item.split('/')[1]}}"}, "description": "Fetch repository information"}
                ], "max_iterations": 5, "description": "Fetch info for each repository"},
                  {"id": "create_spreadsheet", "type": "agent_with_tools", "tool_id": "GOOGLESHEETS_CREATE_GOOGLE_SHEET1", "app_name": "googlesheets", "params": {"title": "Repository Analysis"}, "description": "Create spreadsheet for results"},
                  {"id": "update_spreadsheet", "type": "agent_with_tools", "tool_id": "GOOGLESHEETS_BATCH_UPDATE", "app_name": "googlesheets", "params": {"spreadsheet_id": "${{from_step:create_spreadsheet.spreadsheetId}}", "sheet_name": "Sheet1", "values": [["Repository", "Stars", "Forks", "Language"], "${{from_loop:fetch_repo_loop.results}}"]}, "description": "Add all repository data to spreadsheet"}
                ],
                "edges": [
                  {"from": "collect_repositories", "to": "fetch_repo_loop", "type": "sequential"},
                  {"from": "fetch_repo_loop", "to": "create_spreadsheet", "type": "sequential"},
                  {"from": "create_spreadsheet", "to": "update_spreadsheet", "type": "sequential"}
                ]
              }
              result = WORKFLOW

