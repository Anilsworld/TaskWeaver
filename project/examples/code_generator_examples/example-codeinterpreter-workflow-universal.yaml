enabled: True
description: >-
  Universal workflow definition format supporting ALL patterns (ULTRA-COMPACT).
  
  üö® CRITICAL - TOOL AVAILABILITY CHECK (MANDATORY):
  =====================================================
  Before creating ANY workflow, you MUST check if required tools exist in the "Available Composio Actions" list!
  
  ‚ùå IF TOOLS DON'T EXIST - DO NOT PROCEED:
  - DO NOT invent fake tool_ids like "COMPOSIO_SEARCH_HOTELS", "COMPOSIO_BOOK_HOTEL", "HOTEL_API_SEARCH"
  - DO NOT use plausible-sounding names that seem like they should exist
  - DO NOT generate a workflow hoping the tools will work
  - Instead: Explain clearly what tools are missing
  - Example: "I cannot create a hotel booking workflow because I don't have access to hotel booking APIs 
    in the available actions list. I can create workflows using Gmail, Google Sheets, Slack, Outlook, 
    and 800+ other verified integrations."
  
  ‚úÖ ONLY CREATE WORKFLOWS when ALL required tools exist in the actions list!
  ‚úÖ Every tool_id MUST be copied EXACTLY from the "Available Composio Actions" list
  ‚úÖ Use Python booleans (True/False), NOT JSON booleans (true/false)
  
  üö® CRITICAL - BRACKET MATCHING (MANDATORY):
  =====================================================
  ‚ùå DO NOT use multiline formatting for nested dicts/arrays in params!
  ‚ùå DO NOT pretty-print values like this:
      "values": [
        ["A", "B"],
        ["C", "D"]
      ]
  
  ‚úÖ KEEP EVERYTHING COMPACT - Write each node on ONE LINE:
  ‚úÖ Example: {"id": "node1", "params": {"values": [["A", "B"], ["C", "D"]]}, "description": "..."}
  ‚úÖ This prevents bracket mismatch errors!
  
  **Why?** Multiline formatting causes confusion in bracket counting, leading to syntax errors like:
  - `]}}` (wrong - too many closing braces)
  - `]}` (correct - closes array then dict)

rounds:
  - user_query: Create a workflow to read emails and messages from Outlook, Slack, and Instagram, prepare draft responses for each, show them to me for review, and once I approve send the responses back to each platform respectively.
    state: finished
    post_list:
      - message: Create a workflow to read emails and messages from Outlook, Slack, and Instagram, prepare draft responses for each, show them to me for review, and once I approve send the responses back to each platform respectively.
        send_from: Planner
        send_to: CodeInterpreter
        attachment_list: []
      
      - message: I've created a comprehensive workflow with parallel fetching, HITL approval, and conditional responses using ultra-compact format.
        send_from: CodeInterpreter
        send_to: Planner
        attachment_list:
          - type: thought
            content: |-
              üîç PRE-CHECK: Reviewing available actions for required tools...
              
              ‚úÖ OUTLOOK_FETCH_MESSAGE - CONFIRMED in actions list
              ‚úÖ OUTLOOK_SEND_EMAIL - CONFIRMED in actions list
              ‚úÖ SLACKBOT_LIST_ALL_DIRECT_MESSAGES - CONFIRMED in actions list
              ‚úÖ SLACKBOT_SEND_MESSAGE - CONFIRMED in actions list
              ‚úÖ INSTAGRAM_LIST_ALL_MESSAGES - CONFIRMED in actions list
              ‚úÖ INSTAGRAM_SEND_MESSAGE - CONFIRMED in actions list
              
              All required tools exist! Safe to proceed with workflow generation.
              
              I'll use 4 node types:
              1. agent_with_tools: External API calls (fetch/send via Composio) - uses verified tool_ids
              2. agent_only: AI processing (draft preparation, no external tools)
              3. hitl: Approval/decision step (blocking with decision field)
              4. form: Data collection from user (if user asked for name/email/date inputs)
              
              I'll create an ultra-compact WORKFLOW dict with Python booleans (True/False, not true/false).
          
          - type: reply_type
            content: python
          
          - type: reply_content
            content: |-
              WORKFLOW = {
                "nodes": [
                  {"id": "fetch_outlook", "type": "agent_with_tools", "tool_id": "OUTLOOK_LIST_MESSAGES", "app_name": "outlook", "params": {"folder": "inbox"}, "parallel_group": 1, "description": "Fetch Outlook messages"},
                  {"id": "fetch_slack", "type": "agent_with_tools", "tool_id": "SLACKBOT_LIST_ALL_DIRECT_MESSAGES", "app_name": "slack", "params": {"limit": 10}, "parallel_group": 1, "description": "Fetch Slack messages"},
                  {"id": "fetch_instagram", "type": "agent_with_tools", "tool_id": "INSTAGRAM_LIST_ALL_MESSAGES", "app_name": "instagram", "params": {"limit": 10}, "parallel_group": 1, "description": "Fetch Instagram messages"},
                  {"id": "prepare_drafts", "type": "agent_only", "description": "Prepare draft responses for each message", "params": {"outlook_messages": "${from_step:fetch_outlook.messages}", "slack_messages": "${from_step:fetch_slack.messages}", "instagram_messages": "${from_step:fetch_instagram.messages}"}, "depends_on": ["fetch_outlook", "fetch_slack", "fetch_instagram"]},
                  {"id": "review_responses", "type": "hitl", "form_id": "review_form", "title": "Review Draft Responses", "fields": [{"name": "decision", "type": "select", "options": ["Approve All", "Reject All"], "required": True}, {"name": "comments", "type": "textarea"}], "depends_on": ["prepare_drafts"], "description": "Review and approve responses"},
                  {"id": "send_outlook", "type": "agent_with_tools", "tool_id": "OUTLOOK_SEND_EMAIL", "app_name": "outlook", "params": {"to": "${from_step:fetch_outlook.from}", "subject": "Re: ${from_step:fetch_outlook.subject}", "body": "${from_step:prepare_drafts.outlook_draft}"}, "parallel_group": 2, "description": "Send Outlook response"},
                  {"id": "send_slack", "type": "agent_with_tools", "tool_id": "SLACKBOT_SEND_MESSAGE", "app_name": "slack", "params": {"channel": "${from_step:fetch_slack.channel}", "text": "${from_step:prepare_drafts.slack_draft}"}, "parallel_group": 2, "description": "Send Slack response"},
                  {"id": "send_instagram", "type": "agent_with_tools", "tool_id": "INSTAGRAM_SEND_MESSAGE", "app_name": "instagram", "params": {"recipient_id": "${from_step:fetch_instagram.sender_id}", "message": "${from_step:prepare_drafts.instagram_draft}"}, "parallel_group": 2, "description": "Send Instagram response"}
                ],
                "parallel_groups": {"fetch": ["fetch_outlook", "fetch_slack", "fetch_instagram"], "send": ["send_outlook", "send_slack", "send_instagram"]},
                "conditional_edges": [{"source": "review_responses", "condition": "${review_responses.decision} == 'Approve All'", "if_true": "send_outlook", "if_false": "END"}],
                "sequential_edges": [("prepare_drafts", "review_responses"), ("send_outlook", "END"), ("send_slack", "END"), ("send_instagram", "END")]
              }
              result = WORKFLOW
