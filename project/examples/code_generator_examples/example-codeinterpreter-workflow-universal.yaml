enabled: True
description: >-
  Universal workflow definition format supporting ALL patterns (ULTRA-COMPACT).
  
  üö® CRITICAL - TOOL AVAILABILITY CHECK (MANDATORY):
  =====================================================
  Before creating ANY workflow, you MUST check if required tools exist in the "Available Composio Actions" list!
  
  ‚ùå IF TOOLS DON'T EXIST - DO NOT PROCEED:
  - DO NOT invent fake tool_ids like "COMPOSIO_SEARCH_HOTELS", "COMPOSIO_BOOK_HOTEL", "HOTEL_API_SEARCH"
  - DO NOT use plausible-sounding names that seem like they should exist
  - DO NOT generate a workflow hoping the tools will work
  - Instead: Explain clearly what tools are missing
  - Example: "I cannot create a hotel booking workflow because I don't have access to hotel booking APIs 
    in the available actions list. I can create workflows using Gmail, Google Sheets, Slack, Outlook, 
    and 800+ other verified integrations."
  
  ‚úÖ ONLY CREATE WORKFLOWS when ALL required tools exist in the actions list!
  ‚úÖ Every tool_id MUST be copied EXACTLY from the "Available Composio Actions" list
  ‚úÖ Use Python booleans (True/False), NOT JSON booleans (true/false)
  
  üö® CRITICAL - BRACKET MATCHING (MANDATORY):
  =====================================================
  ‚ùå DO NOT use multiline formatting for nested dicts/arrays in params!
  ‚ùå DO NOT pretty-print values like this:
      "values": [
        ["A", "B"],
        ["C", "D"]
      ]
  
  ‚úÖ KEEP EVERYTHING COMPACT - Write each node on ONE LINE:
  ‚úÖ Example: {"id": "node1", "params": {"values": [["A", "B"], ["C", "D"]]}, "description": "..."}
  ‚úÖ This prevents bracket mismatch errors!
  
  **Why?** Multiline formatting causes confusion in bracket counting, leading to syntax errors like:
  - `]}}` (wrong - too many closing braces)
  - `]}` (correct - closes array then dict)

rounds:
  - user_query: Create a workflow to check my GitHub, GitLab, and Bitbucket repositories for new pull requests, generate AI-powered code review summaries for each, show them to me for approval, and once I approve post the reviews as comments.
    state: finished
    post_list:
      - message: Create a workflow to check my GitHub, GitLab, and Bitbucket repositories for new pull requests, generate AI-powered code review summaries for each, show them to me for approval, and once I approve post the reviews as comments.
        send_from: Planner
        send_to: CodeInterpreter
        attachment_list: []
      
      - message: I've created a comprehensive workflow with parallel fetching, HITL approval, and conditional posting using ultra-compact format.
        send_from: CodeInterpreter
        send_to: Planner
        attachment_list:
          - type: thought
            content: |-
              üîç PRE-CHECK: Reviewing available actions for required tools...
              
              ‚úÖ GITHUB_LIST_PULL_REQUESTS - CONFIRMED in actions list
              ‚úÖ GITHUB_CREATE_COMMENT - CONFIRMED in actions list
              ‚úÖ GITLAB_LIST_MERGE_REQUESTS - CONFIRMED in actions list
              ‚úÖ GITLAB_ADD_COMMENT - CONFIRMED in actions list
              ‚úÖ BITBUCKET_GET_PULL_REQUESTS - CONFIRMED in actions list
              ‚úÖ BITBUCKET_POST_COMMENT - CONFIRMED in actions list
              
              All required tools exist! Safe to proceed with workflow generation.
              
              I'll use 4 node types:
              1. agent_with_tools: External API calls (fetch PRs/post comments via Composio) - uses verified tool_ids
              2. agent_only: AI processing (code review generation, no external tools)
              3. hitl: Approval/decision step (blocking with decision field)
              4. parallel: Simultaneous execution of independent tasks
              
              I'll create an ultra-compact WORKFLOW dict with Python booleans (True/False, not true/false).
          
          - type: reply_type
            content: python
          
          - type: reply_content
            content: |-
              WORKFLOW = {
                "nodes": [
                  {"id": "start", "type": "agent_only", "description": "Start workflow"},
                  {"id": "fetch_all_prs", "type": "parallel", "parallel_nodes": ["fetch_github", "fetch_gitlab", "fetch_bitbucket"], "description": "Fetch PRs from all platforms in parallel"},
                  {"id": "fetch_github", "type": "agent_with_tools", "tool_id": "GITHUB_LIST_PULL_REQUESTS", "app_name": "github", "params": {"state": "open", "per_page": 20}, "description": "Fetch GitHub PRs"},
                  {"id": "fetch_gitlab", "type": "agent_with_tools", "tool_id": "GITLAB_LIST_MERGE_REQUESTS", "app_name": "gitlab", "params": {"state": "opened", "per_page": 20}, "description": "Fetch GitLab MRs"},
                  {"id": "fetch_bitbucket", "type": "agent_with_tools", "tool_id": "BITBUCKET_GET_PULL_REQUESTS", "app_name": "bitbucket", "params": {"state": "OPEN"}, "description": "Fetch Bitbucket PRs"},
                  {"id": "generate_reviews", "type": "agent_only", "description": "Generate AI code reviews", "params": {"github_prs": "${fetch_github.pull_requests}", "gitlab_mrs": "${fetch_gitlab.merge_requests}", "bitbucket_prs": "${fetch_bitbucket.pull_requests}"}},
                  {"id": "approve_reviews", "type": "hitl", "form_id": "review_approval", "title": "Approve Code Reviews", "fields": [{"name": "decision", "type": "select", "options": ["Approve All", "Reject All"], "required": True}, {"name": "notes", "type": "textarea"}], "description": "Review and approve AI-generated reviews"},
                  {"id": "post_all_reviews", "type": "parallel", "parallel_nodes": ["post_github", "post_gitlab", "post_bitbucket"], "description": "Post reviews to all platforms in parallel"},
                  {"id": "post_github", "type": "agent_with_tools", "tool_id": "GITHUB_CREATE_COMMENT", "app_name": "github", "params": {"pr_number": "${fetch_github.pr_number}", "body": "${generate_reviews.github_review}"}, "description": "Post GitHub review"},
                  {"id": "post_gitlab", "type": "agent_with_tools", "tool_id": "GITLAB_ADD_COMMENT", "app_name": "gitlab", "params": {"mr_id": "${fetch_gitlab.mr_id}", "body": "${generate_reviews.gitlab_review}"}, "description": "Post GitLab review"},
                  {"id": "post_bitbucket", "type": "agent_with_tools", "tool_id": "BITBUCKET_POST_COMMENT", "app_name": "bitbucket", "params": {"pr_id": "${fetch_bitbucket.pr_id}", "content": "${generate_reviews.bitbucket_review}"}, "description": "Post Bitbucket review"}
                ],
                "edges": [
                  {"source": "start", "target": "fetch_all_prs"},
                  {"source": "fetch_all_prs", "target": "generate_reviews"},
                  {"source": "generate_reviews", "target": "approve_reviews"},
                  {"source": "approve_reviews", "target": "post_all_reviews", "condition": "${approve_reviews.decision} == 'Approve All'"}
                ]
              }
              result = WORKFLOW
