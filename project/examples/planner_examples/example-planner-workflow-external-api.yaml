enabled: True
rounds:
  - user_query: Create a workflow to submit a customer support ticket - collect customer details, search for similar existing tickets, get manager approval, create the ticket in our system, and notify the team via email
    state: created
    post_list:
      - message: Create a workflow to submit a customer support ticket - collect customer details, search for similar existing tickets, get manager approval, create the ticket in our system, and notify the team via email
        send_from: User
        send_to: Planner
        attachment_list:
      - message: Collect customer details, search for similar tickets, display results, get approval, and if approved send email notifications.
        send_from: Planner
        send_to: CodeInterpreter
        attachment_list:
          - type: plan_reasoning
            content: |-
              The user wants a support ticket workflow with forms and external APIs. I will use input() for forms and composio_action for external services (search, create ticket, send email).
          - type: init_plan
            content: |-
              1. Collect customer details using input() for form fields
              2. Search for similar tickets using composio_action <sequentially depends on 1>
              3. Display results and get manager approval <sequentially depends on 2>
              4. Create ticket using composio_action <sequentially depends on 3>
              5. Send email notification using composio_action <sequentially depends on 4>
              6. Report completion to user <sequentially depends on 5>
          - type: plan
            content: |-
              1. Collect customer details via form
              2. Search for similar existing tickets
              3. Display results
              4. Get approval
              5. Create ticket in system
              6. Send team notification
              7. Report completion
          - type: current_plan_step
            content: 1. Collect customer details via form
          - type: stop
            content: InProcess
      - message: Customer support ticket workflow has been created successfully. The workflow collected details, searched for similar tickets, got approval, created the ticket, and sent notifications.
        send_from: CodeInterpreter
        send_to: Planner
        attachment_list:
          - type: thought
            content: I will generate a workflow that collects data, calls external search API, processes approval logic, and uses external APIs for ticket creation and notifications.
          - type: reply_type
            content: python
          - type: reply_content
            content: |-
              # Step 1: Collect customer details via FORM
              customer_name = input("Enter customer name: ")
              customer_email = input("Enter customer email: ")
              issue_description = input("Describe the issue: ")
              priority = input("Priority (low/medium/high): ")
              
              # Step 2: Search for similar tickets using composio_action
              search_result, search_desc = composio_action(
                  "ZENDESK_SEARCH_TICKETS",
                  {"query": issue_description},
                  None
              )
              similar_tickets = search_result.get('tickets', [])
              
              # Step 3: Display search results
              for ticket in similar_tickets[:3]:
                  print(f"Similar: {ticket.get('id')} - {ticket.get('subject')}")
              
              # Step 4: Get manager approval
              approval = input("Proceed with creating new ticket? (yes/no): ").lower() == 'yes'
              
              if approval:
                  # Step 5: Create ticket using composio_action
                  create_result, create_desc = composio_action(
                      "ZENDESK_CREATE_TICKET",
                      {"subject": issue_description, "priority": priority, "requester_email": customer_email},
                      None
                  )
                  new_ticket_id = create_result.get('ticket', {}).get('id', 'NEW')
                  
                  # Step 6: Send email notification using composio_action
                  email_body = f"New ticket {new_ticket_id}\nCustomer: {customer_name}\nIssue: {issue_description}"
                  email_result, email_desc = composio_action(
                      "GMAIL_SEND_EMAIL",
                      {"to": "support-team@company.com", "subject": f"New Ticket: {new_ticket_id}", "body": email_body},
                      None
                  )
                  result = f"Ticket {new_ticket_id} created and team notified"
              else:
                  result = "Ticket creation cancelled"
              
              result
          - type: verification
            content: CORRECT
          - type: code_error
            content: No code error.
          - type: execution_status
            content: SUCCESS
          - type: execution_result
            content: |-
              Customer support ticket workflow executed successfully. Collected customer details, searched for similar tickets via API, displayed results, processed approval, created ticket via API, and sent email notifications via API.
      - message: The customer support ticket workflow has been completed! It collected customer details, searched for similar existing tickets, displayed the results, got manager approval, created a new ticket in the system, and sent email notifications to the support team.
        send_from: Planner
        send_to: User
        attachment_list:
          - type: plan_reasoning
            content: |-
              The workflow successfully used input() for forms and composio_action for external APIs.
          - type: init_plan
            content: |-
              1. Collect customer details using input() for form fields
              2. Search for similar tickets using composio_action <sequentially depends on 1>
              3. Display results and get manager approval <sequentially depends on 2>
              4. Create ticket using composio_action <sequentially depends on 3>
              5. Send email notification using composio_action <sequentially depends on 4>
              6. Report completion to user <sequentially depends on 5>
          - type: plan
            content: |-
              1. Collect details via form
              2. Search tickets via composio_action
              3. Get approval
              4. Create ticket via composio_action
              5. Send email via composio_action
              6. Report completion
          - type: current_plan_step
            content: 6. Report completion
          - type: stop
            content: Completed

